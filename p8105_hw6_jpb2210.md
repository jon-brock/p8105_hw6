Data Science - Homework \#6
================
Jon Brock - JPB2210

  - [Problem \#1](#problem-1)
  - [Problem \#2](#problem-2)
  - [Return of the Bonus Content](#return-of-the-bonus-content)

``` r
library(tidyverse)
library(modelr)
```

-----

## Problem \#1

###### (*45 points*)

##### *Working with linear models*

I reviewed each vector to determine what vector type each one should be
when imported. There is a majority of integer values, so the `.default`
value for non-specified vectors applies as such. I specified `babysex`,
`frace`, `malform`, and `mrace` as `<fct>` vectors; `gaweeks`, `ppbmi`,
and `smoken` are specified as `<dbl>` vectors. I will further
tidy–relevel and relabel–my specified `<fct>` vectors in subsequent
code.

``` r
bw_df <- read_csv("./data/birthweight.csv",
                  col_names = TRUE,
                  col_types = cols(
                      .default = col_integer(),
                      babysex = col_factor(),
                      frace = col_factor(),
                      gaweeks = col_double(),
                      malform = col_factor(),
                      mrace = col_factor(),
                      ppbmi = col_double(),
                      smoken = col_double()
                      )
                  )

bw_df
```

    ## # A tibble: 4,342 x 20
    ##    babysex bhead blength   bwt delwt fincome frace gaweeks malform menarche
    ##    <fct>   <int>   <int> <int> <int>   <int> <fct>   <dbl> <fct>      <int>
    ##  1 2          34      51  3629   177      35 1        39.9 0             13
    ##  2 1          34      48  3062   156      65 2        25.9 0             14
    ##  3 2          36      50  3345   148      85 1        39.9 0             12
    ##  4 1          34      52  3062   157      55 1        40   0             14
    ##  5 2          34      52  3374   156       5 1        41.6 0             13
    ##  6 1          33      52  3374   129      55 1        40.7 0             12
    ##  7 2          33      46  2523   126      96 2        40.3 0             14
    ##  8 2          33      49  2778   140       5 1        37.4 0             12
    ##  9 1          36      52  3515   146      85 1        40.3 0             11
    ## 10 1          33      50  3459   169      75 2        40.7 0             12
    ## # … with 4,332 more rows, and 10 more variables: mheight <int>,
    ## #   momage <int>, mrace <fct>, parity <int>, pnumlbw <int>, pnumsga <int>,
    ## #   ppbmi <dbl>, ppwt <int>, smoken <dbl>, wtgain <int>

It is rather tedious to check for `NA` values within individual vectors
one at a time. So, instead, I decided to check all vectors at once by
using a “soft-deprecated” `dplyr` function (`funs()`) to summarize all
of the `NA` observations within each vector in my data frame.

``` r
options(tibble.width = Inf)

bw_df %>% 
    select(everything()) %>% 
    summarize_all(funs(sum(is.na(.))))
```

    ## # A tibble: 1 x 20
    ##   babysex bhead blength   bwt delwt fincome frace gaweeks malform menarche
    ##     <int> <int>   <int> <int> <int>   <int> <int>   <int>   <int>    <int>
    ## 1       0     0       0     0     0       0     0       0       0        0
    ##   mheight momage mrace parity pnumlbw pnumsga ppbmi  ppwt smoken wtgain
    ##     <int>  <int> <int>  <int>   <int>   <int> <int> <int>  <int>  <int>
    ## 1       0      0     0      0       0       0     0     0      0      0

The output shows that we have `0` observations of `NA` in all of our
vectors. We’re good to go\!

``` r
bw_df <- 
    bw_df %>% 
    mutate(
        baby_sex = recode(babysex, "1" = "male", "2" = "female"),
        baby_head_cm = bhead,
        baby_length_cm = blength,
        baby_birthweight_grams = bwt,
        mother_weight_grams = delwt * 453.492,
        family_income = fincome,
        father_race = recode(frace, "1" = "white", "2" = "black", "3" = "asian", "4" = "p_rican", "8" = "other", "9" = "unknown"),
        gestation_age_wks = gaweeks,
        malformations_present = recode(malform, "0" = "absent", "1" = "present"),
        mother_menarche_age = menarche,
        mother_height_cm = mheight * 2.54,
        mother_delivery_age = momage,
        mother_race = recode(mrace, "1" = "white", "2" = "black", "3" = "asian", "4" = "p_rican", "8" = "other"),
        number_prior_births = parity,
        number_prior_low_bwt_babies = pnumlbw,
        number_prior_small_ga_babies = pnumsga,
        mother_pre_pregnancy_bmi = ppbmi,
        mother_pre_pregnancy_weight_grams = ppwt * 453.492,
        avg_number_cigs_per_day = smoken,
        mother_pregnancy_weight_gain_grams = wtgain * 453.492) %>% 
    select(c(baby_sex:mother_pregnancy_weight_gain_grams))

print(bw_df)
```

    ## # A tibble: 4,342 x 20
    ##    baby_sex baby_head_cm baby_length_cm baby_birthweight_grams
    ##    <fct>           <int>          <int>                  <int>
    ##  1 female             34             51                   3629
    ##  2 male               34             48                   3062
    ##  3 female             36             50                   3345
    ##  4 male               34             52                   3062
    ##  5 female             34             52                   3374
    ##  6 male               33             52                   3374
    ##  7 female             33             46                   2523
    ##  8 female             33             49                   2778
    ##  9 male               36             52                   3515
    ## 10 male               33             50                   3459
    ##    mother_weight_grams family_income father_race gestation_age_wks
    ##                  <dbl>         <int> <fct>                   <dbl>
    ##  1              80268.            35 white                    39.9
    ##  2              70745.            65 black                    25.9
    ##  3              67117.            85 white                    39.9
    ##  4              71198.            55 white                    40  
    ##  5              70745.             5 white                    41.6
    ##  6              58500.            55 white                    40.7
    ##  7              57140.            96 black                    40.3
    ##  8              63489.             5 white                    37.4
    ##  9              66210.            85 white                    40.3
    ## 10              76640.            75 black                    40.7
    ##    malformations_present mother_menarche_age mother_height_cm
    ##    <fct>                               <int>            <dbl>
    ##  1 absent                                 13             160.
    ##  2 absent                                 14             165.
    ##  3 absent                                 12             163.
    ##  4 absent                                 14             163.
    ##  5 absent                                 13             168.
    ##  6 absent                                 12             168.
    ##  7 absent                                 14             183.
    ##  8 absent                                 12             157.
    ##  9 absent                                 11             155.
    ## 10 absent                                 12             163.
    ##    mother_delivery_age mother_race number_prior_births
    ##                  <int> <fct>                     <int>
    ##  1                  36 white                         3
    ##  2                  25 black                         0
    ##  3                  29 white                         0
    ##  4                  18 white                         0
    ##  5                  20 white                         0
    ##  6                  23 white                         0
    ##  7                  29 black                         0
    ##  8                  19 white                         0
    ##  9                  13 white                         0
    ## 10                  19 black                         0
    ##    number_prior_low_bwt_babies number_prior_small_ga_babies
    ##                          <int>                        <int>
    ##  1                           0                            0
    ##  2                           0                            0
    ##  3                           0                            0
    ##  4                           0                            0
    ##  5                           0                            0
    ##  6                           0                            0
    ##  7                           0                            0
    ##  8                           0                            0
    ##  9                           0                            0
    ## 10                           0                            0
    ##    mother_pre_pregnancy_bmi mother_pre_pregnancy_weight_grams
    ##                       <dbl>                             <dbl>
    ##  1                     26.3                            67117.
    ##  2                     21.3                            58047.
    ##  3                     23.6                            62128.
    ##  4                     21.8                            57593.
    ##  5                     21.0                            58954.
    ##  6                     18.6                            52152.
    ##  7                     14.3                            47617.
    ##  8                     21.8                            53966.
    ##  9                     19.9                            47617.
    ## 10                     24.9                            65756.
    ##    avg_number_cigs_per_day mother_pregnancy_weight_gain_grams
    ##                      <dbl>                              <dbl>
    ##  1                       0                             13151.
    ##  2                       0                             12698.
    ##  3                       1                              4988.
    ##  4                      10                             13605.
    ##  5                       1                             11791.
    ##  6                       0                              6349.
    ##  7                       0                              9523.
    ##  8                       0                              9523.
    ##  9                       0                             18593.
    ## 10                       4                             10884.
    ## # … with 4,332 more rows

We have successfully recoded and renamed all `20` of our variables, and
dropped the original `20` for lack of further need. It’s important to
note that variable measurements were incongruent in terms of scale –
both metric and imperial were used. To correct for this I made the
necessary conversions so that all measurements are metric (i.e., weight
= grams, height/length = centimeters).

``` r
jon_fit <- lm(baby_birthweight_grams ~ 
                  gestation_age_wks +
                  mother_weight_grams +
                  number_prior_low_bwt_babies +
                  avg_number_cigs_per_day,
              data = bw_df)

broom::tidy(jon_fit) %>% 
    knitr::kable()
```

| term                        |      estimate |  std.error |  statistic |   p.value |
| :-------------------------- | ------------: | ---------: | ---------: | --------: |
| (Intercept)                 | \-145.8454947 | 91.7888378 | \-1.588924 | 0.1121504 |
| gestation\_age\_wks         |    62.5747139 |  2.1709484 |  28.823676 | 0.0000000 |
| mother\_weight\_grams       |     0.0124554 |  0.0006804 |  18.307006 | 0.0000000 |
| avg\_number\_cigs\_per\_day |   \-7.0170283 |  0.9184265 | \-7.640272 | 0.0000000 |

``` r
bw_df %>% 
    add_predictions(jon_fit) %>% 
    add_residuals(jon_fit) %>% 
    ggplot(aes(x = gestation_age_wks, y = baby_birthweight_grams)) + 
        geom_point() + 
        stat_smooth(method = "lm")
```

    ## `geom_smooth()` using formula 'y ~ x'

<img src="p8105_hw6_jpb2210_files/figure-gfm/plotting of model, predictions, and residuals-1.png" style="display: block; margin: auto;" />

``` r
        #geom_line(aes(y = pred), color = "red")
```

-----

## Problem \#2

###### (*35 points*)

##### *Bootstrapping*

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())

weather_df
```

    ## # A tibble: 365 x 6
    ##    name           id          date        prcp  tmax  tmin
    ##    <chr>          <chr>       <date>     <dbl> <dbl> <dbl>
    ##  1 CentralPark_NY USW00094728 2017-01-01     0   8.9   4.4
    ##  2 CentralPark_NY USW00094728 2017-01-02    53   5     2.8
    ##  3 CentralPark_NY USW00094728 2017-01-03   147   6.1   3.9
    ##  4 CentralPark_NY USW00094728 2017-01-04     0  11.1   1.1
    ##  5 CentralPark_NY USW00094728 2017-01-05     0   1.1  -2.7
    ##  6 CentralPark_NY USW00094728 2017-01-06    13   0.6  -3.8
    ##  7 CentralPark_NY USW00094728 2017-01-07    81  -3.2  -6.6
    ##  8 CentralPark_NY USW00094728 2017-01-08     0  -3.8  -8.8
    ##  9 CentralPark_NY USW00094728 2017-01-09     0  -4.9  -9.9
    ## 10 CentralPark_NY USW00094728 2017-01-10     0   7.8  -6  
    ## # … with 355 more rows

``` r
boot_strap <- 
    weather_df %>% 
    modelr::bootstrap(n = 5000) %>% 
    mutate(
        models = map(strap, ~lm(tmax ~ tmin, data = .x)),
        tidy_models = map(models, broom::tidy),
        glance_models = map(models, broom::glance)) %>% 
    unnest(tidy_models, glance_models) %>% 
    select(.id, term, estimate, r.squared) %>% 
    pivot_wider(
        names_from = term,
        values_from = estimate) %>% 
    rename(
        beta_0 = `(Intercept)`,
        beta_1 = tmin) %>% 
    mutate(log_b0xb1 = log(beta_0*beta_1)) %>% 
    select(r.squared, log_b0xb1)
```

    ## Warning: unnest() has a new interface. See ?unnest for details.
    ## Try `df %>% unnest(c(tidy_models, glance_models))`, with `mutate()` if needed

``` r
boot_strap %>% 
    ggplot(aes(x = r.squared)) + geom_density()
```

![](p8105_hw6_jpb2210_files/figure-gfm/density%20plot%20of%20r.squared%20values-1.png)<!-- -->

``` r
boot_strap %>% 
    ggplot(aes(x = log_b0xb1)) + geom_density()
```

![](p8105_hw6_jpb2210_files/figure-gfm/density%20plot%20of%20log\(beta0*beta1\)-1.png)<!-- -->

-----

## Return of the Bonus Content
